# Claw-Empire v1.2.0 Release Notes

- Release date: 2026-02-25
- Scope: Agent management (hire/edit/delete), department CRUD, department management tab, DORO character sprite, project-level manual agent assignment, meeting participant filtering for manual projects, mobile-responsive Project Manager, and bug fixes.

## Highlights

### Agent Management (CRUD)
- **Hire New Agent** - Full agent creation UI in Agent Manager with name (multilingual: en/ko/ja/zh), department, role (team_leader/senior/junior/intern), CLI provider, sprite number, avatar emoji, and personality fields.
- **Edit Agent** - Inline edit for all agent fields including provider/model reassignment.
- **Delete Agent** - Safe deletion with working-status guard; cascading NULL-ification on tasks, subtasks, meeting minutes, report archives, and review decision states.
- Backend: `POST /api/agents`, `PATCH /api/agents/:id`, `DELETE /api/agents/:id` endpoints with WebSocket broadcast (`agent_created`, `agent_deleted`).

### Department CRUD
- **Create Department** - Full department creation with ID validation (`a-z0-9` pattern), multilingual names, icon, color picker, description, and prompt.
- **Edit Department** - Inline editing of all department properties.
- **Delete Department** - Removal with associated agent/task guards.
- Backend: `POST /api/departments`, `PATCH /api/departments/:id`, `DELETE /api/departments/:id` endpoints with `departments_changed` broadcast.

### Department Management Tab
- Added **subtab toggle** (`Agents | Departments`) inside Agent Manager.
- Department list view with sort order, icon, name, color, agent count, description, and ID.
- **Sort order editing** via arrow buttons and drag-and-drop, with batch save.
- Backend: `PATCH /api/departments/reorder` endpoint using temporary high-value `sort_order` to avoid UNIQUE constraint conflicts during reorder.
- Routing guard added so `/api/departments/reorder` is not captured by `/api/departments/:id`.

### DORO Character Sprite (Sprite #13)
- Added new character **DORO** with full directional sprite set (D-1/D-2/D-3, L-1, R-1).
- Added `scripts/generate-doro-sprites.mjs` for sprite generation pipeline.
- AgentAvatar and OfficeView updated for sprite #13 support.

### Project Manual Agent Assignment
- Projects now support `assignment_mode`: `auto` (default) or `manual`.
- In manual mode, specific agents can be assigned via multi-select checkbox UI with sprite avatar icons and department/role labels.
- New DB schema: `assignment_mode` column on `projects` table + `project_agents` junction table.
- Backend CRUD: `POST /api/projects` and `PATCH /api/projects/:id` accept `assignment_mode` and `agent_ids`.
- `GET /api/projects` and `GET /api/projects/:id` return `assigned_agent_ids` per project.

### Meeting Participant Filtering (Manual Mode)
- When a project uses `assignment_mode: manual`, kickoff and review meetings only include:
  - **Planning team leader** (always included)
  - **Team leaders from departments of the assigned agents**
- `fallbackAll` expansion (invite all active team leaders) is skipped for manual-mode projects.
- Applies to both kickoff (`startPlannedApprovalMeeting`) and review (`startReviewConsensusMeeting`) meetings.

### Task Delegation with Manual Mode
- `findBestSubordinate` in `collab.ts` accepts optional `candidateAgentIds`.
- Manual mode queries `project_agents` and restricts candidates to the assigned agent pool.
- Candidate filtering is additionally constrained to the active team leader's department.
- If no assigned candidate exists for that department in manual mode, fallback to full-department auto selection is blocked.
- Auto mode projects retain existing delegation logic unchanged.

### ChatPanel Manual Mode Indicator
- Project confirm step displays assigned agent count for manual-mode projects (for example: "Manual mode - 2 assigned agents will work on this").

### Mobile-Responsive Project Manager
- **List-detail toggle pattern** for mobile viewports (below `md` / 768px):
  - Project list takes full width when no project is selected.
  - Selecting a project or creating new hides the list and shows detail view.
  - Mobile-only back button returns to project list.
- Desktop layout remains side-by-side.

### Bug Fixes
- Fixed project save `500` caused by unresolved `runInTransaction` binding in `core.ts`.
- Improved light-mode error readability in `ProjectManagerModal` (`text-rose-800`/`text-cyan-800` variants).
- Fixed `/api/departments/reorder` save failure caused by route collision with `/api/departments/:id`.
- Added internal scroll behavior for Agent Manager emoji picker (`max-h` + `overflow-y-auto`).
- Added internal scroll behavior for Agent Manager hire/edit modal (`max-h` + `overflow-y-auto`).

## Changed Files

### Frontend
- `src/types/index.ts` - Added `AssignmentMode` and extended `Project`.
- `src/api.ts` - Added `reorderDepartments()`, extended project CRUD fields.
- `src/App.tsx` - Agent/department live-sync updates.
- `src/components/AgentManager.tsx` - Agent CRUD UI, department tab, reorder UX.
- `src/components/AgentAvatar.tsx` - Sprite #13 support.
- `src/components/AgentDetail.tsx`
- `src/components/AgentSelect.tsx`
- `src/components/AgentStatusPanel.tsx`
- `src/components/Dashboard.tsx`
- `src/components/OfficeView.tsx`
- `src/components/ProjectManagerModal.tsx`
- `src/components/TaskBoard.tsx`
- `src/components/ChatPanel.tsx`

### Backend
- `server/server-main.ts` - DB migration (`assignment_mode`, `project_agents`).
- `server/modules/routes/core.ts` - Agent/department/project APIs, reorder routing guard, transaction binding fix.
- `server/modules/routes/collab.ts` - Manual-mode candidate filtering hardening.
- `server/modules/workflow/orchestration/meetings.ts` - Manual-mode meeting participant filtering.
- `server/security/auth.ts`

### Assets
- `public/sprites/13-D-1.png`, `13-D-2.png`, `13-D-3.png`, `13-L-1.png`, `13-R-1.png`
- `public/sprites/14-D-1.png`, `14-D-2.png`, `14-D-3.png`, `14-L-1.png`, `14-R-1.png`
- `scripts/generate-doro-sprites.mjs`

### Docs
- `README.md`
- `README_ko.md`
- `README_jp.md`
- `README_zh.md`
- `docs/releases/README.md`
- `docs/releases/v1.2.0.md`

## Verification

- `npx tsc --noEmit` - passed
- `npx vite build` - passed
