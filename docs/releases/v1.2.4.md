# Claw-Empire v1.2.4 Release Notes

- Release date: 2026-02-28
- Scope: Workflow Pack / Office Pack operational rollout and direct messenger routing stability update, covering pack-based office profiles, agent/department sync, multi-token messenger isolation, and inbox/session handling hardening.

## Highlights

### 1. Workflow Pack Platform Rollout

- Added first-class workflow pack definitions and runtime APIs for pack-aware orchestration.
- Built-in pack keys now include:
  - `development`
  - `report`
  - `web_research_report`
  - `novel`
  - `video_preprod`
  - `roleplay`
- Added `/api/workflow-packs` route and schema/runtime support for pack metadata and enabled-state management.
- Messenger session settings now support per-session `workflowPackKey`, enabling channel-session based task style routing.

### 2. Office Pack UX and Real Data Isolation

- Moved Office Pack selector to the top header for faster context switching while keeping office canvas focus intact.
- Added pack-specific office presets (room themes, department naming, staff naming/persona seeds) with multilingual labels.
- Implemented pack profile isolation for non-development packs so each pack keeps independent agent/department datasets.
- Agent/Department management now applies CRUD/reorder changes against the selected pack profile in isolated packs, while development pack keeps existing DB-backed behavior.
- Fixed office avatar rendering consistency so non-development pack characters use proper sprite avatars instead of emoji fallbacks.

### 3. Messenger Multi-Token Route Isolation

- Hardened route resolution for same-provider multi-session setups where `targetId` may overlap across different bot tokens.
- Added token-hint route keying (`<channel>#<tokenKey>`) for internal source disambiguation without exposing raw tokens.
- Session route matching now validates both `targetId` and token-key context when present.
- Telegram receiver now supports per-token route processing and per-token offset persistence to avoid cross-token poll collisions.
- Result: when multiple Telegram bots point to the same chat/channel ID, replies are routed back to the correct originating bot/session.

### 4. Inbox Session Reset and Project Flow Reliability

- Added `/new` messenger command handling to reset direct-chat session binding state and start a fresh conversation thread.
- Reset ACK messages are localized (KO/EN/JA/ZH) and delivered on the same route.
- Improved existing/new project guidance flow with stronger multilingual intent fallback and recent-project selection stability.
- Existing-project candidate output now supports concise numbered selection patterns with clearer latest-project emphasis.

### 5. Decision Notice Readability v2

- Decision request formatting was further compacted for messenger readability:
  - short planning-lead summary block
  - concise option previews
  - clearer numeric single/multi-reply guidance
- Added recommendation extraction/output refinements so planning-lead recommendation is surfaced as a cleaner numeric suggestion line.
- Preserved multilingual parsing and numeric reply compatibility (`1`, `1,3`, `1 3`) with route-aware ACK delivery.

### 6. Stability and Test Coverage Additions

- Added/expanded regression coverage for:
  - messenger client session routing behavior
  - messenger token-aware route resolution
  - Telegram receiver multi-token handling
  - office pack normalization and sync planning logic
- Runtime typing and route dependency wiring were tightened around collab/inbox/session handling paths.

## API and Behavior Notes

- New/expanded workflow-pack surface:
  - `GET /api/workflow-packs`
- Messenger session payloads include optional:
  - `workflowPackKey`
  - per-session `token` override
- Internal source route may include token hint suffix:
  - `<channel>#<tokenKey>` (for route disambiguation only)

## Compatibility Notes

- Existing `development` office behavior remains backward compatible.
- Non-development packs use isolated profile data by design and do not overwrite the development office baseline.
